# pullreq-assigner

Микросервис, который автоматически назначает ревьюеров на Pull Request’ы

## Стек

- Go (golang 1.25)
- PostgreSQL 15
- Библиотеки:
    * `github.com/jmoiron/sqlx` — расширение для работы с SQL запросами
    * `github.com/lib/pq` — драйвер для постгреса
    
    > Иных сторонних пакетов не установлено.

Соответственно для контейнеризации используется Docker и docker-compose.

## Запуск и информация

Сервис работает на порте **8080** в соответствии с тз. 

Сборка может быть запущена с помощью команды

```bash
docker-compose up --build
```

Окружение для базы данных указано в поле environment файла docker-compose.yml

Если установлен make, то для удобства можно воспользоваться более короткой командой

```bash
make up
```

Формально она выполняет роль бинда для docker-compose. Makefile позволяет также запустить е2е тест и сброс хранилища командами `make test` `make down` соответственно.

## Структура и решения

- Решение представлено в виде "слоистой" архитектуры с разделением ответственности: логика, модели и обработка данных вынесены в отдельные пакеты. Структура выглядит следующим образом:

```md
.
├── docker-compose.yml
├── Dockerfile
├── go.mod
├── go.sum
├── internal
│   ├── entity
│   │   └── models.go
│   ├── handler
│   │   └── handler.go
│   ├── service
│   │   └── service.go
│   └── storage
│       └── storage.go
├── Makefile
├── migrations
│   └── init.sql
├── README.md
├── server
│   └── main.go
└── tests
    └── e2e_test.go
```

- База данных связывает пулл-реквесты и ревьюверов через отдельную таблицу; инициализация таблиц происходит при первом запуске приложения – `./migrations/init.sql` прокинут в docker-compose. Операции по записи и обновлению представлены в виде транзакций во избежание потерь данных и гарантии целоностноти.

- Ошибки базы данных (насколько было возможно) маппятся с соответствующими HTTP кодами для сообщения на клиент.

- Алгоритм выбора ревьюера реализован через генератор случайных чисел.

- Спецификации соблюдены в соответствии с приложенным `openapi.yml`

## Сложности и нюансы

- Было бы хорошим тоном добавить больше тестов, в том числе и unit для тестирования отдельных компонентов, однако, к сожалению, в проде остался только е2е тест, проверяющий сценарий пользователя, что обеспечивает не 100% покрытие.

- В основном до этого на веб-проектах я питонячил и джэ-эсил, поэтому постарался реализовать как можно больше лучших практик Golang; сделал, скорее всего, не "перфекто", ахах. Решил все-таки выбрать именно Go для того, чтобы как можно быстрее вкатиться не на примере абстрактной задачи на ворочанье структур, а веб-сервиса с конкретными целями.

Спасибо, что уделили внимание!
